

# ğŸ–¥ï¸ Backend Architecture (MVP)
**Hosting:** Railway (Node.js API + Postgres)  

## 1. Core Responsibilities  
- **Authentication**: Manage user accounts (recommend Firebase Auth for speed, or NextAuth w/ JWT if self-managed).  
- **Real-time Messaging**: Handle chat-roomâ€“based message broadcast via WebSockets (`socket.io`).  
- **Persistence**: Store users, rooms, and messages in Postgres.  
- **Push Notifications**: Send push notifications for new messages via Firebase Cloud Messaging (both web + Android).  
- **REST API Layer**: CRUD endpoints for users, rooms, and messages.  

---

## 2. High-Level Architecture  
```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  React Web (Next) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ React Native App  â”‚
         â”‚ (Android + FCM)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚   WebSockets (real-time)
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Node.js Backend (Railway)â”‚
        â”‚ - Express REST API        â”‚
        â”‚ - Socket.io (real-time)   â”‚
        â”‚ - Auth (Firebase/Auth JWT)â”‚
        â”‚ - Push integration (FCM)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Postgres (Railway)    â”‚
         â”‚ - users               â”‚
         â”‚ - rooms               â”‚
         â”‚ - messages            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Backend Tech Stack (Recommended MVP)

- **Runtime**: Node.js 20, deployed on Railway  
- **Frameworks**: Express (API layer) + socket.io (real-time)  
- **Database**: Postgres on Railway (managed DB)  
- **Auth**: Firebase Auth (simplest cross-platform option)  
- **Notifications**: Firebase Cloud Messaging (FCM)  
- **Deployment**: CI/CD via GitHub â†’ Railway  

---

## 4. API Endpoints (MVP Set)

### Auth  
- `POST /auth/signup` â€“ create new account  
- `POST /auth/login` â€“ authenticate (JWT returned if not Firebase)  

### Rooms  
- `POST /rooms` â€“ create room  
- `GET /rooms` â€“ list rooms  
- `GET /rooms/:id` â€“ get room details + messages  

### Messages  
- `POST /rooms/:id/messages` â€“ send message  
- `GET /rooms/:id/messages` â€“ fetch last N messages  

---

## 5. Data Model

**Users**  
- `id` (UUID, PK)  
- `email` (unique)  
- `password_hash` (if not Firebase)  
- `fcm_token` (for push notifications, nullable)  
- `created_at`  

**Rooms**  
- `id` (UUID, PK)  
- `name` (varchar)  
- `created_by` (FK â†’ users.id)  
- `created_at`  

**Messages**  
- `id` (UUID, PK)  
- `room_id` (FK â†’ rooms.id)  
- `user_id` (FK â†’ users.id)  
- `content` (text)  
- `timestamp` (UTC)  

---

## 6. Push Notification Flow  
1. User logs in â†’ frontend registers device/browser push token â†’ sent to backend â†’ stored in DB.  
2. When a new message is posted:  
   - Message written to DB.  
   - Broadcasted via WebSockets to all connected clients in that room.  
   - Backend sends FCM push notification to all **offline/inactive devices** in that room.  

---

## 7. Scaling Considerations (Post-MVP)  
- Move Socket.io into Redis-backed pub/sub for horizontal scaling.  
- Add message delivery acknowledgments.  
- Introduce rate-limiting / abuse prevention on APIs.  
- Event-driven queue (e.g. Kafka or RabbitMQ) for decoupling push notifications from request cycle.  

---

âš¡ In short: **One backend service on Railway** handles everything in MVP: API + WebSockets + Push + DB.  
Later, notifications and real-time messaging could be split into services for scale.  
